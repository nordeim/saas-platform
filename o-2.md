Dockerfile

# backend/Dockerfile (continued)
FROM python:3.12-slim as base

# Set environment variables
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    POETRY_VERSION=1.7.1 \
    POETRY_HOME="/opt/poetry" \
    POETRY_VIRTUALENVS_IN_PROJECT=true \
    POETRY_NO_INTERACTION=1 \
    PYSETUP_PATH="/opt/pysetup" \
    VENV_PATH="/opt/pysetup/.venv"

ENV PATH="$POETRY_HOME/bin:$VENV_PATH/bin:$PATH"

# Builder stage
FROM base as builder

# Install system dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    curl \
    libpq-dev \
    git \
    && rm -rf /var/lib/apt/lists/*

# Install Poetry
RUN curl -sSL https://install.python-poetry.org | python3 -

# Copy project files
WORKDIR $PYSETUP_PATH
COPY pyproject.toml poetry.lock ./

# Install dependencies
RUN poetry install --no-dev --no-root

# Production stage
FROM base as production

# Install runtime dependencies
RUN apt-get update && apt-get install -y \
    libpq5 \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Copy virtual environment from builder
COPY --from=builder $VENV_PATH $VENV_PATH

# Create app user
RUN useradd -m -u 1000 appuser && \
    mkdir -p /app /app/static /app/media /app/logs && \
    chown -R appuser:appuser /app

# Copy application
WORKDIR /app
COPY --chown=appuser:appuser . .

# Switch to non-root user
USER appuser

# Health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:8000/health/ || exit 1

# Run application
CMD ["gunicorn", "config.wsgi:application", \
     "--bind", "0.0.0.0:8000", \
     "--workers", "4", \
     "--threads", "2", \
     "--worker-class", "gthread", \
     "--worker-tmp-dir", "/dev/shm", \
     "--access-logfile", "-", \
     "--error-logfile", "-", \
     "--log-level", "info", \
     "--timeout", "120", \
     "--graceful-timeout", "30", \
     "--max-requests", "1000", \
     "--max-requests-jitter", "50"]
Dockerfile

# frontend/Dockerfile
FROM node:20-alpine as base

# Builder stage
FROM base as builder

WORKDIR /app

# Copy package files
COPY package*.json ./
COPY yarn.lock* ./
COPY pnpm-lock.yaml* ./

# Install dependencies
RUN if [ -f yarn.lock ]; then yarn install --frozen-lockfile; \
    elif [ -f pnpm-lock.yaml ]; then corepack enable pnpm && pnpm install --frozen-lockfile; \
    else npm ci; fi

# Copy application files
COPY . .

# Build application
ARG NEXT_PUBLIC_API_URL
ARG NEXT_PUBLIC_WS_URL
ENV NEXT_PUBLIC_API_URL=$NEXT_PUBLIC_API_URL
ENV NEXT_PUBLIC_WS_URL=$NEXT_PUBLIC_WS_URL

RUN if [ -f yarn.lock ]; then yarn build; \
    elif [ -f pnpm-lock.yaml ]; then pnpm build; \
    else npm run build; fi

# Production stage
FROM base as production

WORKDIR /app

# Install dumb-init for proper signal handling
RUN apk add --no-cache dumb-init

# Create app user
RUN addgroup -g 1001 nodejs && \
    adduser -S nextjs -u 1001

# Copy built application
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static
COPY --from=builder --chown=nextjs:nodejs /app/public ./public

# Switch to non-root user
USER nextjs

# Expose port
EXPOSE 3000

# Health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD node healthcheck.js

# Start application
ENTRYPOINT ["dumb-init", "--"]
CMD ["node", "server.js"]
9.2 Kubernetes Deployment
YAML

# kubernetes/base/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: techflow-prod
  labels:
    name: techflow-prod
    environment: production

---
# kubernetes/base/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: techflow-config
  namespace: techflow-prod
data:
  DJANGO_SETTINGS_MODULE: "config.settings.production"
  CELERY_BROKER_URL: "redis://redis-service:6379/0"
  CELERY_RESULT_BACKEND: "redis://redis-service:6379/1"
  NEXT_PUBLIC_API_URL: "https://api.techflow.sg"
  NEXT_PUBLIC_WS_URL: "wss://api.techflow.sg"

---
# kubernetes/base/secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: techflow-secrets
  namespace: techflow-prod
type: Opaque
stringData:
  DATABASE_URL: "postgresql://user:password@postgres-service:5432/techflow"
  REDIS_URL: "redis://:password@redis-service:6379/0"
  SECRET_KEY: "your-secret-key-here"
  STRIPE_SECRET_KEY: "sk_live_..."
  SENDGRID_API_KEY: "SG...."
  AWS_ACCESS_KEY_ID: "AKIA..."
  AWS_SECRET_ACCESS_KEY: "..."

---
# kubernetes/base/deployment-backend.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend-deployment
  namespace: techflow-prod
  labels:
    app: backend
    tier: application
spec:
  replicas: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      app: backend
  template:
    metadata:
      labels:
        app: backend
        tier: application
    spec:
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app
                  operator: In
                  values:
                  - backend
              topologyKey: kubernetes.io/hostname
      
      containers:
      - name: django
        image: techflow/backend:latest
        imagePullPolicy: Always
        ports:
        - containerPort: 8000
          name: http
        
        envFrom:
        - configMapRef:
            name: techflow-config
        - secretRef:
            name: techflow-secrets
        
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        
        livenessProbe:
          httpGet:
            path: /health/
            port: 8000
          initialDelaySeconds: 30
          periodSeconds: 30
          timeoutSeconds: 10
          failureThreshold: 3
        
        readinessProbe:
          httpGet:
            path: /ready/
            port: 8000
          initialDelaySeconds: 10
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3
        
        volumeMounts:
        - name: static-files
          mountPath: /app/staticfiles
        - name: media-files
          mountPath: /app/mediafiles
      
      volumes:
      - name: static-files
        persistentVolumeClaim:
          claimName: static-pvc
      - name: media-files
        persistentVolumeClaim:
          claimName: media-pvc

---
# kubernetes/base/deployment-frontend.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: frontend-deployment
  namespace: techflow-prod
  labels:
    app: frontend
    tier: presentation
spec:
  replicas: 2
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      app: frontend
  template:
    metadata:
      labels:
        app: frontend
        tier: presentation
    spec:
      containers:
      - name: nextjs
        image: techflow/frontend:latest
        imagePullPolicy: Always
        ports:
        - containerPort: 3000
          name: http
        
        envFrom:
        - configMapRef:
            name: techflow-config
        
        resources:
          requests:
            memory: "128Mi"
            cpu: "100m"
          limits:
            memory: "256Mi"
            cpu: "200m"
        
        livenessProbe:
          httpGet:
            path: /api/health
            port: 3000
          initialDelaySeconds: 20
          periodSeconds: 30
        
        readinessProbe:
          httpGet:
            path: /api/health
            port: 3000
          initialDelaySeconds: 10
          periodSeconds: 10

---
# kubernetes/base/deployment-celery.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: celery-worker-deployment
  namespace: techflow-prod
  labels:
    app: celery-worker
    tier: background
spec:
  replicas: 2
  selector:
    matchLabels:
      app: celery-worker
  template:
    metadata:
      labels:
        app: celery-worker
        tier: background
    spec:
      containers:
      - name: celery-worker
        image: techflow/backend:latest
        imagePullPolicy: Always
        
        command: ["celery"]
        args: ["-A", "config", "worker", "-l", "info", "--concurrency=4"]
        
        envFrom:
        - configMapRef:
            name: techflow-config
        - secretRef:
            name: techflow-secrets
        
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"

---
# kubernetes/base/deployment-celery-beat.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: celery-beat-deployment
  namespace: techflow-prod
  labels:
    app: celery-beat
    tier: background
spec:
  replicas: 1  # Only one beat scheduler
  selector:
    matchLabels:
      app: celery-beat
  template:
    metadata:
      labels:
        app: celery-beat
        tier: background
    spec:
      containers:
      - name: celery-beat
        image: techflow/backend:latest
        imagePullPolicy: Always
        
        command: ["celery"]
        args: ["-A", "config", "beat", "-l", "info", "--scheduler", "django_celery_beat.schedulers:DatabaseScheduler"]
        
        envFrom:
        - configMapRef:
            name: techflow-config
        - secretRef:
            name: techflow-secrets
        
        resources:
          requests:
            memory: "128Mi"
            cpu: "100m"
          limits:
            memory: "256Mi"
            cpu: "200m"

---
# kubernetes/base/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: backend-service
  namespace: techflow-prod
  labels:
    app: backend
spec:
  type: ClusterIP
  ports:
  - port: 8000
    targetPort: 8000
    protocol: TCP
    name: http
  selector:
    app: backend

---
apiVersion: v1
kind: Service
metadata:
  name: frontend-service
  namespace: techflow-prod
  labels:
    app: frontend
spec:
  type: ClusterIP
  ports:
  - port: 3000
    targetPort: 3000
    protocol: TCP
    name: http
  selector:
    app: frontend

---
# kubernetes/base/ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: techflow-ingress
  namespace: techflow-prod
  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
    nginx.ingress.kubernetes.io/rate-limit: "100"
    nginx.ingress.kubernetes.io/limit-rps: "20"
spec:
  tls:
  - hosts:
    - techflow.sg
    - api.techflow.sg
    secretName: techflow-tls
  
  rules:
  - host: techflow.sg
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: frontend-service
            port:
              number: 3000
  
  - host: api.techflow.sg
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: backend-service
            port:
              number: 8000

---
# kubernetes/base/hpa.yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: backend-hpa
  namespace: techflow-prod
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: backend-deployment
  minReplicas: 3
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 60
      policies:
      - type: Percent
        value: 100
        periodSeconds: 60
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Percent
        value: 50
        periodSeconds: 60
9.3 CI/CD Pipeline
YAML

# .github/workflows/ci-cd.yml
name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]
  workflow_dispatch:

env:
  REGISTRY: ghcr.io
  BACKEND_IMAGE: ghcr.io/${{ github.repository }}/backend
  FRONTEND_IMAGE: ghcr.io/${{ github.repository }}/frontend

jobs:
  # Backend Testing
  test-backend:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:16
        env:
          POSTGRES_USER: test
          POSTGRES_PASSWORD: test
          POSTGRES_DB: test_db
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
        ports:
          - 5432:5432
      
      redis:
        image: redis:7.4
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
        ports:
          - 6379:6379
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'
      
      - name: Install dependencies
        run: |
          cd backend
          pip install -r requirements/test.txt
      
      - name: Run linting
        run: |
          cd backend
          black --check .
          flake8 .
          mypy .
      
      - name: Run tests with coverage
        env:
          DATABASE_URL: postgresql://test:test@localhost/test_db
          REDIS_URL: redis://localhost:6379/0
          SECRET_KEY: test-secret-key
        run: |
          cd backend
          pytest --cov=. --cov-report=xml --cov-report=term
      
      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
        with:
          file: ./backend/coverage.xml
          flags: backend
      
      - name: Security scan with Bandit
        run: |
          cd backend
          bandit -r apps/
  
  # Frontend Testing
  test-frontend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json
      
      - name: Install dependencies
        run: |
          cd frontend
          npm ci
      
      - name: Run linting
        run: |
          cd frontend
          npm run lint
      
      - name: Type checking
        run: |
          cd frontend
          npm run type-check
      
      - name: Run tests with coverage
        run: |
          cd frontend
          npm run test:ci
      
      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
        with:
          file: ./frontend/coverage/coverage-final.json
          flags: frontend
      
      - name: Build application
        run: |
          cd frontend
          npm run build
  
  # E2E Testing
  test-e2e:
    runs-on: ubuntu-latest
    needs: [test-backend, test-frontend]
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: Start services with docker-compose
        run: |
          docker-compose -f docker-compose.test.yml up -d
          sleep 30  # Wait for services to be ready
      
      - name: Run E2E tests
        run: |
          cd frontend
          npm ci
          npm run cypress:run
      
      - name: Upload E2E test artifacts
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: cypress-artifacts
          path: |
            frontend/cypress/screenshots
            frontend/cypress/videos
  
  # Build and Push Images
  build-and-push:
    runs-on: ubuntu-latest
    needs: [test-backend, test-frontend, test-e2e]
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    
    permissions:
      contents: read
      packages: write
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: Log in to Container Registry
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Extract metadata
        id: meta
        run: |
          echo "version=$(date +'%Y%m%d')-${{ github.run_number }}" >> $GITHUB_OUTPUT
          echo "sha_short=$(git rev-parse --short HEAD)" >> $GITHUB_OUTPUT
      
      - name: Build and push backend image
        uses: docker/build-push-action@v5
        with:
          context: ./backend
          push: true
          tags: |
            ${{ env.BACKEND_IMAGE }}:latest
            ${{ env.BACKEND_IMAGE }}:${{ steps.meta.outputs.version }}
            ${{ env.BACKEND_IMAGE }}:${{ steps.meta.outputs.sha_short }}
          cache-from: type=registry,ref=${{ env.BACKEND_IMAGE }}:buildcache
          cache-to: type=registry,ref=${{ env.BACKEND_IMAGE }}:buildcache,mode=max
          build-args: |
            BUILD_VERSION=${{ steps.meta.outputs.version }}
      
      - name: Build and push frontend image
        uses: docker/build-push-action@v5
        with:
          context: ./frontend
          push: true
          tags: |
            ${{ env.FRONTEND_IMAGE }}:latest
            ${{ env.FRONTEND_IMAGE }}:${{ steps.meta.outputs.version }}
            ${{ env.FRONTEND_IMAGE }}:${{ steps.meta.outputs.sha_short }}
          cache-from: type=registry,ref=${{ env.FRONTEND_IMAGE }}:buildcache
          cache-to: type=registry,ref=${{ env.FRONTEND_IMAGE }}:buildcache,mode=max
          build-args: |
            NEXT_PUBLIC_API_URL=${{ secrets.PRODUCTION_API_URL }}
            BUILD_VERSION=${{ steps.meta.outputs.version }}
  
  # Deploy to Production
  deploy:
    runs-on: ubuntu-latest
    needs: build-and-push
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    
    environment:
      name: production
      url: https://techflow.sg
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up kubectl
        uses: azure/setup-kubectl@v3
        with:
          version: 'v1.29.0'
      
      - name: Configure kubectl
        run: |
          echo "${{ secrets.KUBE_CONFIG }}" | base64 -d > kubeconfig
          export KUBECONFIG=kubeconfig
      
      - name: Deploy to Kubernetes
        run: |
          kubectl set image deployment/backend-deployment \
            django=${{ env.BACKEND_IMAGE }}:${{ github.run_number }} \
            -n techflow-prod
          
          kubectl set image deployment/frontend-deployment \
            nextjs=${{ env.FRONTEND_IMAGE }}:${{ github.run_number }} \
            -n techflow-prod
          
          kubectl rollout status deployment/backend-deployment -n techflow-prod
          kubectl rollout status deployment/frontend-deployment -n techflow-prod
      
      - name: Run smoke tests
        run: |
          curl -f https://api.techflow.sg/health/ || exit 1
          curl -f https://techflow.sg || exit 1
      
      - name: Notify deployment
        if: always()
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          text: 'Deployment to production ${{ job.status }}'
          webhook_url: ${{ secrets.SLACK_WEBHOOK }}
10. Development Standards
10.1 Coding Standards
Python

# Python/Django Coding Standards
"""
TechFlow Python/Django Coding Standards

1. Follow PEP 8 with line length of 100 characters
2. Use type hints for all function parameters and return values
3. Write docstrings for all classes and functions
4. Use meaningful variable names (no single letters except in loops)
5. Prefer composition over inheritance
6. Keep functions small and focused (< 20 lines preferred)
7. Use Django's built-in features when available
"""

# Example of properly formatted Python code
from typing import Optional, List, Dict, Any
from django.db import models, transaction
from django.core.exceptions import ValidationError
from django.utils.translation import gettext_lazy as _
import logging

logger = logging.getLogger(__name__)


class BaseModel(models.Model):
    """
    Abstract base model providing common fields and methods.
    
    All models should inherit from this base model to ensure
    consistent timestamps and soft delete functionality.
    """
    
    created_at = models.DateTimeField(
        _('created at'),
        auto_now_add=True,
        help_text=_('Date and time when the record was created')
    )
    updated_at = models.DateTimeField(
        _('updated at'),
        auto_now=True,
        help_text=_('Date and time when the record was last updated')
    )
    deleted_at = models.DateTimeField(
        _('deleted at'),
        null=True,
        blank=True,
        help_text=_('Date and time when the record was soft deleted')
    )
    
    class Meta:
        abstract = True
        ordering = ['-created_at']
    
    def soft_delete(self) -> None:
        """
        Soft delete the record by setting deleted_at timestamp.
        
        This method does not actually delete the record from the database,
        but marks it as deleted for filtering purposes.
        """
        from django.utils import timezone
        
        self.deleted_at = timezone.now()
        self.save(update_fields=['deleted_at'])
        
        logger.info(
            f"Soft deleted {self.__class__.__name__} with ID {self.pk}"
        )
    
    def restore(self) -> None:
        """
        Restore a soft deleted record by clearing deleted_at timestamp.
        """
        self.deleted_at = None
        self.save(update_fields=['deleted_at'])
        
        logger.info(
            f"Restored {self.__class__.__name__} with ID {self.pk}"
        )
TypeScript

// TypeScript/React Coding Standards
/**
 * TechFlow TypeScript/React Coding Standards
 * 
 * 1. Use functional components with hooks
 * 2. Prefer composition over inheritance
 * 3. Use TypeScript strict mode
 * 4. Define interfaces for all props
 * 5. Use meaningful component and variable names
 * 6. Keep components small and focused
 * 7. Extract custom hooks for reusable logic
 * 8. Use absolute imports with @ alias
 */

// Example of properly formatted TypeScript/React code
import React, { useState, useCallback, useMemo } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { z } from 'zod';
import { api } from '@/lib/api/client';
import { Button } from '@/components/ui/button';
import { toast } from '@/components/ui/use-toast';
import type { Organization, User } from '@/lib/types';

// Define validation schema
const inviteMemberSchema = z.object({
  email: z.string().email('Invalid email address'),
  role: z.enum(['owner', 'admin', 'member', 'viewer']),
  sendInvitation: z.boolean().default(true),
});

// Define component props interface
interface InviteMemberFormProps {
  organization: Organization;
  onSuccess?: (member: User) => void;
  onCancel?: () => void;
}

/**
 * Form component for inviting new members to an organization.
 * 
 * @param {InviteMemberFormProps} props - Component props
 * @returns {JSX.Element} Rendered form component
 */
export function InviteMemberForm({
  organization,
  onSuccess,
  onCancel,
}: InviteMemberFormProps): JSX.Element {
  const [formData, setFormData] = useState({
    email: '',
    role: 'member' as const,
    sendInvitation: true,
  });
  
  // Mutation for inviting member
  const inviteMutation = useMutation({
    mutationFn: async (data: z.infer<typeof inviteMemberSchema>) => {
      return api.post(`/organizations/${organization.id}/members`, data);
    },
    onSuccess: (response) => {
      toast({
        title: 'Member invited',
        description: `Invitation sent to ${formData.email}`,
      });
      onSuccess?.(response.data);
    },
    onError: (error: any) => {
      toast({
        title: 'Invitation failed',
        description: error.response?.data?.message || 'An error occurred',
        variant: 'destructive',
      });
    },
  });
  
  // Form submission handler
  const handleSubmit = useCallback(
    async (e: React.FormEvent) => {
      e.preventDefault();
      
      try {
        const validatedData = inviteMemberSchema.parse(formData);
        await inviteMutation.mutateAsync(validatedData);
      } catch (error) {
        if (error instanceof z.ZodError) {
          const firstError = error.errors[0];
          toast({
            title: 'Validation error',
            description: firstError.message,
            variant: 'destructive',
          });
        }
      }
    },
    [formData, inviteMutation]
  );
  
  // Memoized form validation
  const isFormValid = useMemo(() => {
    try {
      inviteMemberSchema.parse(formData);
      return true;
    } catch {
      return false;
    }
  }, [formData]);
  
  return (
    <form onSubmit={handleSubmit} className="space-y-4">
      {/* Form fields */}
      <div>
        <label
          htmlFor="email"
          className="block text-sm font-medium text-gray-700"
        >
          Email Address
        </label>
        <input
          id="email"
          type="email"
          value={formData.email}
          onChange={(e) =>
            setFormData((prev) => ({ ...prev, email: e.target.value }))
          }
          className="mt-1 block w-full rounded-md border-gray-300"
          required
        />
      </div>
      
      {/* Action buttons */}
      <div className="flex justify-end space-x-2">
        <Button
          type="button"
          variant="outline"
          onClick={onCancel}
          disabled={inviteMutation.isPending}
        >
          Cancel
        </Button>
        <Button
          type="submit"
          disabled={!isFormValid || inviteMutation.isPending}
          loading={inviteMutation.isPending}
        >
          Send Invitation
        </Button>
      </div>
    </form>
  );
}
10.2 Git Workflow
Bash

# .gitmessage
# <type>(<scope>): <subject>
#
# <body>
#
# <footer>
#
# Type should be one of the following:
# - feat: A new feature
# - fix: A bug fix
# - docs: Documentation changes
# - style: Code style changes (formatting, etc)
# - refactor: Code refactoring
# - perf: Performance improvements
# - test: Adding or updating tests
# - chore: Build process or auxiliary tool changes
#
# Scope should be the module/component affected
# Subject should be a brief description (< 50 chars)
# Body should explain what and why (wrap at 72 chars)
# Footer should reference issues (e.g., Closes #123)
YAML

# .github/pull_request_template.md
## Description
Brief description of the changes in this PR.

## Type of Change
- [ ] Bug fix (non-breaking change which fixes an issue)
- [ ] New feature (non-breaking change which adds functionality)
- [ ] Breaking change (fix or feature that would cause existing functionality to not work as expected)
- [ ] Documentation update

## How Has This Been Tested?
- [ ] Unit tests pass locally
- [ ] Integration tests pass locally
- [ ] Manual testing completed

## Checklist
- [ ] My code follows the style guidelines of this project
- [ ] I have performed a self-review of my own code
- [ ] I have commented my code, particularly in hard-to-understand areas
- [ ] I have made corresponding changes to the documentation
- [ ] My changes generate no new warnings
- [ ] I have added tests that prove my fix is effective or that my feature works
- [ ] New and existing unit tests pass locally with my changes

## Screenshots (if applicable)
Add screenshots to help explain your changes.

## Related Issues
Closes #(issue number)
11. Testing Architecture
11.1 Testing Strategy
Python

# backend/tests/conftest.py
import pytest
from django.test import Client
from django.contrib.auth import get_user_model
from rest_framework.test import APIClient
from apps.organizations.models import Organization
from apps.subscriptions.models import Subscription
import factory
from factory.django import DjangoModelFactory
from datetime import timedelta
from django.utils import timezone

User = get_user_model()

# Factories
class UserFactory(DjangoModelFactory):
    class Meta:
        model = User
    
    email = factory.Sequence(lambda n: f"user{n}@example.com")
    username = factory.Sequence(lambda n: f"user{n}")
    first_name = factory.Faker('first_name')
    last_name = factory.Faker('last_name')
    is_active = True
    
    @factory.post_generation
    def password(self, create, extracted, **kwargs):
        if not create:
            return
        if extracted:
            self.set_password(extracted)
        else:
            self.set_password('testpass123')

class OrganizationFactory(DjangoModelFactory):
    class Meta:
        model = Organization
    
    name = factory.Faker('company')
    slug = factory.Sequence(lambda n: f"org-{n}")
    domain = factory.Faker('domain_name')

class SubscriptionFactory(DjangoModelFactory):
    class Meta:
        model = Subscription
    
    organization = factory.SubFactory(OrganizationFactory)
    tier = 'starter'
    status = 'active'
    current_period_start = factory.LazyFunction(timezone.now)
    current_period_end = factory.LazyFunction(
        lambda: timezone.now() + timedelta(days=30)
    )

# Fixtures
@pytest.fixture
def api_client():
    """Provide an API client for testing"""
    return APIClient()

@pytest.fixture
def authenticated_client(api_client, user):
    """Provide an authenticated API client"""
    api_client.force_authenticate(user=user)
    return api_client

@pytest.fixture
def user():
    """Create a test user"""
    return UserFactory()

@pytest.fixture
def organization():
    """Create a test organization"""
    return OrganizationFactory()

@pytest.fixture
def subscription(organization):
    """Create a test subscription"""
    return SubscriptionFactory(organization=organization)

@pytest.fixture
def organization_with_members(organization, user):
    """Create organization with members"""
    organization.add_member(user, role='owner')
    for i in range(3):
        member = UserFactory()
        organization.add_member(member, role='member')
    return organization

# Test base classes
class APITestCase:
    """Base class for API tests"""
    
    @pytest.fixture(autouse=True)
    def setup_method(self, api_client):
        self.client = api_client
    
    def assert_status(self, response, expected_status):
        """Assert response status code"""
        assert response.status_code == expected_status, \
            f"Expected {expected_status}, got {response.status_code}: {response.data}"
    
    def assert_error(self, response, field, message=None):
        """Assert error in response"""
        assert 'errors' in response.data
        errors = response.data['errors']
        field_errors = [e for e in errors if e.get('field') == field]
        assert field_errors, f"No errors for field {field}"
        if message:
            assert message in field_errors[0]['message']
TypeScript

// frontend/tests/setup.ts
import '@testing-library/jest-dom';
import { cleanup } from '@testing-library/react';
import { afterEach, beforeAll, afterAll, vi } from 'vitest';
import { server } from './mocks/server';

// Mock environment variables
process.env.NEXT_PUBLIC_API_URL = 'http://localhost:3000';

// Setup MSW
beforeAll(() => {
  server.listen({ onUnhandledRequest: 'error' });
});

afterEach(() => {
  cleanup();
  server.resetHandlers();
});

afterAll(() => {
  server.close();
});

// Mock Next.js router
vi.mock('next/router', () => ({
  useRouter: () => ({
    push: vi.fn(),
    replace: vi.fn(),
    prefetch: vi.fn(),
    back: vi.fn(),
    pathname: '/',
    query: {},
    asPath: '/',
  }),
}));

// Mock Next.js image
vi.mock('next/image', () => ({
  __esModule: true,
  default: ({ src, alt, ...props }: any) => {
    return <img src={src} alt={alt} {...props} />;
  },
}));

// Test utilities
export const createMockUser = (overrides = {}) => ({
  id: '123',
  email: 'test@example.com',
  firstName: 'Test',
  lastName: 'User',
  avatar: null,
  ...overrides,
});

export const createMockOrganization = (overrides = {}) => ({
  id: '456',
  name: 'Test Organization',
  slug: 'test-org',
  ...overrides,
});

export const renderWithProviders = (
  ui: React.ReactElement,
  options = {}
) => {
  const Wrapper = ({ children }: { children: React.ReactNode }) => {
    return (
      <QueryClient>
        {children}
      </QueryClient>
    );
  };
  
  return render(ui, { wrapper: Wrapper, ...options });
};
11.2 E2E Testing
TypeScript

// cypress/e2e/auth.cy.ts
describe('Authentication Flow', () => {
  beforeEach(() => {
    cy.visit('/');
  });
  
  it('should allow user to sign up', () => {
    cy.get('[data-cy=signup-button]').click();
    
    cy.get('[data-cy=email-input]').type('newuser@example.com');
    cy.get('[data-cy=password-input]').type('SecurePassword123!');
    cy.get('[data-cy=confirm-password-input]').type('SecurePassword123!');
    cy.get('[data-cy=first-name-input]').type('John');
    cy.get('[data-cy=last-name-input]').type('Doe');
    cy.get('[data-cy=organization-name-input]').type('Acme Corp');
    
    cy.get('[data-cy=submit-button]').click();
    
    // Should redirect to dashboard
    cy.url().should('include', '/dashboard');
    cy.contains('Welcome, John').should('be.visible');
  });
  
  it('should allow user to login', () => {
    cy.get('[data-cy=login-button]').click();
    
    cy.get('[data-cy=email-input]').type('existing@example.com');
    cy.get('[data-cy=password-input]').type('Password123!');
    
    cy.get('[data-cy=submit-button]').click();
    
    cy.url().should('include', '/dashboard');
  });
  
  it('should handle MFA authentication', () => {
    cy.get('[data-cy=login-button]').click();
    
    cy.get('[data-cy=email-input]').type('mfa@example.com');
    cy.get('[data-cy=password-input]').type('Password123!');
    cy.get('[data-cy=submit-button]').click();
    
    // Should show MFA prompt
    cy.get('[data-cy=mfa-code-input]').should('be.visible');
    cy.get('[data-cy=mfa-code-input]').type('123456');
    cy.get('[data-cy=verify-button]').click();
    
    cy.url().should('include', '/dashboard');
  });
});
12. Error Handling Specifications
12.1 Error Handling Matrix
Error Type	HTTP Status	Error Code	Client Action	Logging
Validation Error	400	VALIDATION_ERROR	Display field errors	Warning
Authentication Failed	401	AUTH_FAILED	Redirect to login	Info
Permission Denied	403	PERMISSION_DENIED	Show error message	Warning
Resource Not Found	404	NOT_FOUND	Show 404 page	Info
Rate Limit Exceeded	429	RATE_LIMIT	Show retry message	Warning
Internal Server Error	500	SERVER_ERROR	Show error page	Error
Service Unavailable	503	SERVICE_UNAVAILABLE	Show maintenance	Error
12.2 Error Handler Implementation
Python

# apps/core/exceptions.py
from rest_framework.views import exception_handler
from rest_framework.response import Response
from rest_framework import status
from django.core.exceptions import ValidationError as DjangoValidationError
from django.db import IntegrityError
import logging
import traceback

logger = logging.getLogger(__name__)

class APIException(Exception):
    """Base API exception"""
    status_code = status.HTTP_500_INTERNAL_SERVER_ERROR
    error_code = 'SERVER_ERROR'
    default_message = 'An error occurred'
    
    def __init__(self, message=None, details=None):
        self.message = message or self.default_message
        self.details = details or {}
        super().__init__(self.message)

class ValidationError(APIException):
    status_code = status.HTTP_400_BAD_REQUEST
    error_code = 'VALIDATION_ERROR'
    default_message = 'Validation failed'

class AuthenticationError(APIException):
    status_code = status.HTTP_401_UNAUTHORIZED
    error_code = 'AUTH_FAILED'
    default_message = 'Authentication failed'

class PermissionError(APIException):
    status_code = status.HTTP_403_FORBIDDEN
    error_code = 'PERMISSION_DENIED'
    default_message = 'Permission denied'

class NotFoundError(APIException):
    status_code = status.HTTP_404_NOT_FOUND
    error_code = 'NOT_FOUND'
    default_message = 'Resource not found'

class RateLimitError(APIException):
    status_code = status.HTTP_429_TOO_MANY_REQUESTS
    error_code = 'RATE_LIMIT'
    default_message 

